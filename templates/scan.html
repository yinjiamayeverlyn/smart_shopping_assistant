<!DOCTYPE html>
<html>
<head>
    <title>Scan</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="container text-center mt-3">
    <h1>Real-Time Scanning</h1>

    <img src="{{ url_for('video_feed') }}" id="video" width="640" height="480">

    <!-- View Cart Button -->
    <div>
        <a href="{{ url_for('cart') }}" class="btn btn-success">View Cart</a>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="productModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">Product Detected</h5>
            <button type="button" class="btn-close" id="closeModal"></button>
          </div>
          <div class="modal-body">
            <p id="modalPrice"></p>
            Quantity: <input type="number" id="modalQty" value="1" min="1">
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" id="addCart">Add to Cart</button>
            <a href="{{ url_for('cart') }}" class="btn btn-success">View Cart</a>
          </div>
        </div>
      </div>
    </div>
</div>


<script>
function checkDetected(){
    $.get("/get_detected", function(data){
        if (data && data.name){
            $("#modalTitle").text(data.name);
            $("#modalPrice").text("Price: RM" + parseFloat(data.price).toFixed(2));
            $("#productModal").modal('show');
        }
    });
}
setInterval(checkDetected, 500);

$("#addCart").click(function(){
    let qty = parseInt($("#modalQty").val());
    $.post("/add_to_cart", {quantity: qty}, function(){
        $("#productModal").modal('hide');
    });
});

$("#closeModal").click(function(){
    $.post("/cancel_detected", {}, function(){
        $("#productModal").modal('hide');
    });
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
